/**/_jsload2&&_jsload2('clayer', 'A.extend(rb.prototype,{jl:{},Lj:[],Nu:"",vq:"",DG:"",kl:q,Ug:q,Tg:q,Sg:[],CG:0,hz:u(),cz:u(),Ju:u(),Dd:function(){this.KG()},za:function(a,b){vd.prototype.za.call(this,a,b);this.jl={};this.Lj=[];this.P=a;this.KG()},At:ea(p),remove:function(){vd.prototype.remove.call(this);this.HT()},KG:function(){var a=this,b=a.P;b&&(this.hz=function(b){a.YS(b)},this.cz=function(b){a.yS(b)},this.Ju=function(b){a.xS(b)},b.addEventListener("mousemove",this.hz),b.addEventListener("onhotspotover",this.cz),b.addEventListener("onhotspotout", this.Ju),b.addEventListener("onzoomstart",this.Ju))},HT:function(){var a=this.P;a&&(a.removeEventListener("mousemove",this.hz),a.removeEventListener("onhotspotover",this.cz),a.removeEventListener("onhotspotout",this.Ju))},YS:function(a){var b=this,c=b.P,e=c.ya();if(c.la()<this.kc||c.Vd())b.lB();else if(a=e.uj().Hg(a.point),e=e.Nd(),a=new R(Math.floor(a.x*Math.pow(2,c.la()-18)),Math.floor(a.y*Math.pow(2,c.la()-18))),e=new R(Math.floor(a.x/e),Math.floor(a.y/e)),this.vq=c=e.x+"_"+e.y+"_"+c.la(),this.jl[c]){if(this.Nu!= c){b.lB();b.JG(this.jl[c]);this.Nu=c;for(var e=-1,a=0,f=this.Lj.length;a<f;a++)if(c==this.Lj[a]){e=a;break}0<=e&&(this.Lj.splice(e,e),this.Lj.push(c))}}else if(this.DG!=c){this.DG=c;e=Dd[parseInt(Math.random()*Dd.length)];a=b.fb;c=e+"/data?grids="+c+"&q="+a.Ut+"&tags="+a.sO+"&filter="+a.filter+"&sortby="+a.jO+"&ak="+a.ZB+"&page_size="+a.wN+"&age="+a.QJ;b.If?c+="&geotable_id="+b.If:b.Sn&&(c+="&databox_id="+b.Sn);var g=(1E5*Math.random()).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+g]=function(a){b.qS(a); delete D._rd["_cbk"+g]};qa(c+("&callback=BMap._rd._cbk"+g))}},qS:function(a){var b=this.P,c=a.content;if(!(a.status!=this.CG||!c||1>c.length)){for(var a=[],e=c[0].data,b=b.ya().uj(),f=0,g=e.length;f<g;f++){var i=e[f][2].replace(rb.ST,"").split(","),i=b.xh(new L(i[0],i[1]));a.push({pt:i,userdata:{name:e[f][0]||"name",size:e[f][4]?e[f][4].split("|"):[10,13],uid:e[f][1]||"",Xb:e[f][3]||"sid1"}})}c=c[0].grid.join("_");this.jl[c]=a;this.Lj.push(c);30<this.Lj.length&&(c=this.Lj.shift(),delete this.jl[c], delete c);this.Nu!=this.vq&&(this.lB(),this.jl[this.vq]&&(this.JG(this.jl[this.vq]),this.Nu=this.vq))}},JG:function(a){for(var b=this.P,c=0,e=a.length;c<e;c++){var f=a[c].userdata.size,g=f[0]/2,f=f[1]/2,g=new lb(a[c].pt,{offsets:[f,g,f,g],userData:a[c].userdata});b.RB(g,this.fb.$D)}},lB:function(){this.P.Ow(this.fb.$D)},yS:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.fb.$D)){this.Sg=a.spots;var b=this,a=this.Sg[0].getUserData().size[0],c="",e=b.P,f="",g=b.fb.WY;0<this.Sg.length&& (c=this.Sg[0].getUserData().name);if(this.Ug)this.Ug.va(this.Sg[0].ma()),this.Tg.Pc(c),this.Tg.Rd(new N(a,0)),this.Ug.show(),c?this.Tg.show():this.Tg.aa();else{var i=this.Sg[0].getUserData().size,f=this.Sg[0].getUserData().Xb,k=this.If||this.Sn;this.kl=new $c(I.ua+"blank.gif",new N(i[0],i[1]),{anchor:new N(i[0]/2+1,i[1]/2+1)});this.hS(k,f,function(){b.Ug&&b.Ug.Wb(b.kl)});this.Ug=new W(this.Sg[0].ma(),{icon:this.kl,enableMassClear:t});e.Ra(this.Ug);this.Tg=new dd(c,{offset:new N(a,0)});this.Tg.Td({backgroundColor:g.backgroundColor, borderColor:g.borderColor});this.Ug.Fj(this.Tg);c?this.Tg.show():this.Tg.aa();this.Ug.addEventListener("onclick",function(){if(!(b.Sg.length<1)&&b.Sg[0].getUserData().uid){var a=b.fb,c=a.nY;if(b.If)c=a.oY;a=c+b.Sg[0].getUserData().uid+"?scope=2&ak="+a.ZB;b.If&&(a=a+("&geotable_id="+b.If));var e=(Math.random()*1E5).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+e]=function(a){b.gS(a);delete D._rd["_cbk"+e]};qa(a+("&callback=BMap._rd._cbk"+e))}})}}},gS:function(a){var b=a.content;this.If&&(b=a.contents[0]); if(a&&a.status==this.CG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.If?b.title:b.name,address:this.If?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.If?new L(b.location[0],b.location[1]):new L(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(rb.VT,"").split(rb.TT),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new A.lang.Iu("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},xS:function(){this.Ug&&this.Ug.aa();this.Tg&&this.Tg.aa()},hS:function(a,b,c){var e=this,f=Ed+"?method=getstyle&databox="+a+"&sid="+b,g=(1E5*Math.random()).toFixed(0);if(!e.kl||!(e.kl.databoxid==a&&e.kl.sid==b))!D._rd&&(D._rd={}),D._rd["_cbk"+g]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(e.kl.VN(b),c&&c(a));delete D._rd["_cbk"+g]},qa(f+("&callback=BMap._rd._cbk"+ g))}}); ');
